<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 添加 Bootstrap 样式链接 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="../CSS/global.css">
    <link rel="stylesheet" href="../CSS/Cart.css">
    <!-- Leaflet CSS 文件 -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
 
    <!-- Leaflet JavaScript 文件 -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    

    <title>Shopping Cart</title>
</head>
<body>

<!--导航栏--> 
<%- include('partials/navbar') %>

<!-- 网页主体开始 -->
<main class="container">
    <!-- 标题部分 -->
    <h1>Shopping Cart</h1>
    <h2>You have <span id="itemCount"><%= cartItems.length %></span> item(s) in your cart</h2>

<!-- 物品显示区域 -->
<div class="row">
    <!-- 左侧购物车物品展示区域 -->
    <div class="col-md-8" id="cartItems">
        <% cartItems.forEach((cartItem, index) => { %>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title"><%= cartItem.title %></h5>
                    <p>Size: <%= cartItem.size %></p>
                    <p>Price: <%= cartItem.price %></p>
                    <button class="btn btn-danger btn-sm float-right remove-item" data-id="<%= cartItem.itemId %>">-</button>
                </div>
            </div>
        <% }); %>
    </div>

    <!-- 右侧支付详情区域 -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Payment Details</h5>

                <!-- Payment Type Logo -->
                <div class="row">
                    <div class="col-md-3">
                        <img src="../Cart/Maestro.png" alt="Logo 1">
                    </div>
                    <div class="col-md-3">
                        <img src="../Cart/Mastercard.png" alt="Logo 2">
                    </div>
                    <div class="col-md-3">
                        <img src="../Cart/UnionPay.png" alt="Logo 3">
                    </div>
                    <div class="col-md-3">
                        <img src="../Cart/Visa.png" alt="Logo 4">
                    </div>
                </div>

                <!-- Payment Type -->
                <div class="form-group">
                    <label for="paymentType">Payment Type</label>
                    <select class="form-control" id="paymentType">
                        <option>Credit Card</option>
                        <option>Debit Card</option>
                        <option>PayPal</option>
                    </select>
                </div>

                <!-- Card Number -->
                <div class="form-group">
                    <label for="cardNumber">Card Number</label>
                    <input type="text" class="form-control" id="cardNumber">
                </div>

                <!-- Expiration Date -->
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="expirationMonth">Expiration Date</label>
                        <input type="text" class="form-control" id="expirationMonth" placeholder="MM">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="expirationYear"> </label>
                        <input type="text" class="form-control" id="expirationYear" placeholder="YYYY">
                    </div>
                </div>

                <!-- CVV -->
                <div class="form-group">
                    <label for="cvv">CVV</label>
                    <input type="text" class="form-control" id="cvv">
                </div>

                <!-- Subtotal -->
                <p>Subtotal: <span id="subtotal">￥<%= calculateSubtotal(cartItems) %></span></p>

                <!-- Shipping -->
                <p>Shipping: <span id="shipping">￥30.00</span></p>

                <!-- Total (Tax incl.) -->
                <p>Total (Tax incl.10%): <span id="total">￥<%= (parseFloat(calculateSubtotal(cartItems)) * 1.1+30).toFixed(2) %></span></p>
                <!-- Pay按钮 -->
                <button type="button" class="btn btn-primary btn-block" id="payButton">Pay</button>
            </div>
        </div>
    </div>
</div>
</main>
<!-- 网页主体结束 -->

    <!-- 底部开始 -->
    <%- include('partials/footer') %>

    <!-- 底部结束 -->

<!-- 添加 Bootstrap JavaScript 依赖 -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


<script>
    // 获取购物车物品展示区域
    const cartItemsContainer = document.getElementById('cartItems');
      // 监听删除按钮点击事件
      cartItemsContainer.addEventListener('click', (event) => {
        if (event.target.classList.contains('remove-item')) {
            const itemId = event.target.dataset.id;
            // 发送删除请求到服务器
            axios.post('/remove-from-cart', { itemId })
                .then(response => {
                    console.log(response.data);
                    // 弹窗提示成功移出购物车
                alert('Successfully removed from shopping cart');
                // 刷新页面
                window.location.reload();
                })
                .catch(error => {
                    console.error('Error removing item:', error);
                    // 处理错误情况
                });
        }
    });
    document.getElementById('payButton').addEventListener('click', function() {
    // 弹出确认支付的提示框
    if (confirm("Confirm payment?")) {
        // 用户确认支付，执行发送支付请求的操作
        pay();
    }
});

// 支付函数
function pay() {
    axios.post('/pay')
        .then(response => {
            // 支付成功，处理响应
            alert('Payment successful!');
            // 刷新页面或其他操作
            window.location.reload();
        })
        .catch(error => {
            // 处理支付失败的情况
            console.error('Error paying:', error);
            alert('Payment failed, please try again!');
        });
}


</script>
<script>
    // 创建地图并设置中心点坐标和缩放级别
    var map = L.map('map').setView([18.7953, 98.9529], 15);

    // 添加地图图层
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // 添加标记并设置清迈大学的位置
    // 在地图上添加标记（清迈大学的位置）
    L.marker([18.80046,98.95095]).addTo(map)
          .bindPopup("<b>Chiang Mai University</b>").openPopup();
         
</script>


</body>
</html>
